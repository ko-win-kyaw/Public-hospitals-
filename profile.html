<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile & Cover Upload Fix</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <link rel="stylesheet" href="style.css">

    <style>
    body { 
    background: var(--bg); 
    display: flex; 
    flex-direction: column; /* á€¡á€•á€±á€«á€ºá€¡á€±á€¬á€€á€º á€…á€®á€á€­á€¯á€„á€ºá€¸á€á€¬á€•á€« */
    align-items: center;    /* á€¡á€œá€šá€ºá€á€Šá€·á€ºá€á€Šá€·á€º á€›á€±á€¬á€€á€ºá€¡á€±á€¬á€„á€ºá€•á€« */
    padding: 60px 20px 20px 20px; /* Header á€”á€²á€· á€™á€œá€½á€á€ºá€¡á€±á€¬á€„á€º á€¡á€•á€±á€«á€ºá€€ á€•á€­á€¯á€á€»á€‘á€¬á€¸á€á€¬á€•á€« */
}
#mediaPreviewBox{
    margin-top: 15px;
    margin-bottom: 15px;}


        :root { --purple: #800080; --bg: #f0f2f5; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .profile-card { background: white; width: 100%; max-width: 400px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .cover-photo { width: 100%; height: 160px; background: #ccc; position: relative; }
        .cover-photo img { width: 100%; height: 100%; object-fit: cover; }
        .btn-cover { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .profile-info { display: flex; align-items: flex-end; padding: 0 15px 15px; margin-top: -50px; }
        .avatar-box { position: relative; width: 100px; height: 100px; }
        .avatar-box img { width: 100%; height: 100%; border-radius: 50%; border: 4px solid white; background: #eee; object-fit: cover; }
        .btn-avatar { position: absolute; bottom: 0; right: 0; background: var(--purple); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 2px solid white; cursor: pointer; }
        .name-box { margin-left: 15px; margin-bottom: 5px; }
        .loading { display: none; text-align: center; padding: 10px; color: var(--purple); font-weight: bold; }
        .global-header {
            position: fixed; top: 0; width: 100%; height: 45px;
            background-color: purple; display: flex;
            justify-content: space-between; align-items: center;
            padding: 0 15px; z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%; /* á€•á€¼á€„á€ºá€†á€„á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸ */
    height: 85px;
    padding: 0 15px;
    background-color: #800080;
    position: fixed;
    top: 0;
    left: 0; /* á€•á€¼á€„á€ºá€†á€„á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸ */
    z-index: 1000;
    border-radius: 15px; /* á€•á€¼á€„á€ºá€†á€„á€ºá€‘á€¬á€¸á€á€¼á€„á€ºá€¸ - á€‘á€±á€¬á€„á€·á€ºá€™á€»á€¬á€¸á€€á€½á€±á€¸á€…á€±á€›á€”á€º */
}


.logo { display: flex; align-items: center; }
.e-box {
    width: 50px; height: 50px;
    position: relative;
    display: flex; justify-content: center; align-items: center;
}
.e-box::before {
    content: ""; position: absolute; inset: 0;
    border: 3px solid white; border-right: none;
    border-radius: 8px 15px 15px 8px;
    box-shadow: 0 0 8px #ffcc70;
}
.e-letter { font-size: 33px; font-weight: 800; color: #f3b64d; }
.logo-text { font-size: 28px; font-weight: 700; color: white; margin-left: -10px; }
.feedback-area {
    margin-top: 15px;
    margin-bottom: 80px;
.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #000;
    font-size: 10px;
.nav-item img { width: 24px; height: 20px; }
.nav-item.active { color: purple; font-weight: bold; }
 </style>
</head>
<body>
      <header class="global-header">
        <div class="logo">
            <div class="e-box"><span class="e-letter">E</span></div>
            <div class="logo-text">m</div>
        </div>
        <div class="header-tools" style="font-size: 22px;">
            <a href="sug.html">ğŸ‘¥</a>
            <a href="noti.html">ğŸ””</a>
            <button style="font-size: 20px;color: purple;" onclick="alert('á€™á€¼á€”á€ºá€™á€¬á€˜á€¬á€á€¬á€á€­á€¯á€· á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€”á€±á€á€Šá€º...')">e/á€™</button>
        </div>
    </header>
<div class="profile-card">
    <div class="cover-photo">
        <img src="https://via.placeholder.com/800x300?text=No+Cover" id="userCover">
        <label for="coverIn" class="btn-cover">ğŸ“· Edit Cover</label>
        <input type="file" id="coverIn" hidden onchange="doUpload(this, 'cover')">
    </div>

    <div class="profile-info">
        <div class="avatar-box">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" id="userAvatar">
            <label for="avatarIn" class="btn-avatar">ğŸ“·</label>
            <input type="file" id="avatarIn" hidden onchange="doUpload(this, 'avatar')">
        </div>
        <div class="name-box">
            <h3 id="pName">Loading...</h3>
            <p style="font-size: 12px; color: gray;">Normal User</p>
        </div>
    </div>
    <div id="status" class="loading">á€•á€¯á€¶á€á€„á€ºá€”á€±á€•á€«á€á€Šá€º...</div>
</div><br>
        <div class="card">
            <textarea id="postContent" rows="3" placeholder=" á€—á€Ÿá€¯á€á€¯á€á€™á€»á€¬á€¸ á€™á€»á€¾á€á€±á€•á€«..." style="width:100%; border-radius:8px; padding:10px; border:1px solid #ddd;"></textarea>
            <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
                <input type="file" id="mediaInput" accept="image/*,video/*" style="display:none;" onchange="previewMedia(this)">
                <div style="background-color: #f33;
                width:100%;color: #fff;border-radius: 8px; text-align: center;">
                    ğŸ‘‹ á€—á€®á€’á€®á€šá€­á€¯ 20mb á€á€¬á€á€„á€ºá€œá€­á€¯á€·á€›
                    á€á€Šá€ºğŸ™
                </div>
                <label for="mediaInput" class="upload-label" style="background:#eee; padding:10px; border-radius:5px; cursor:pointer; flex:1; text-align:center;">ğŸ“· á€•á€¯á€¶/á€—á€®á€’á€®á€šá€­á€¯ á€›á€½á€±á€¸á€›á€”á€º</label>
                <button id="btnPost" class="btn-post" style="flex:1; margin:0;" onclick="uploadAndPost()">á€á€„á€ºá€™á€Šá€º</button>
            </div>
            <div id="mediaPreviewBox" style="margin-top:10px;background-color: light purple;width:height: auto;display:none; text-align:center;"></div>
            </div>
                <div class="apply-grid">
        <div class="apply-card gold-card">
            <h5>á€›á€½á€¾á€±á€›á€±á€¬á€„á€º $ á€¡á€€á€±á€¬á€„á€·á€º</h5>
            <p style="font-size: 10px;">Apply for Gold Tier</p>
           <a href="gold.html"><button
          >á€œá€»á€¾á€±á€¬á€€á€ºá€‘á€¬á€¸á€›á€”á€º</button></a>
        </div>
        <div class="apply-card crown-card">
            <h5>á€á€›á€™á€ºá€¸á€›á€±á€¬á€„á€º Crown</h5>
            <p style="font-size: 10px;">Lifetime Membership</p>
           <a href="purple.html">
               <button>á€œá€»á€¾á€±á€¬á€€á€ºá€‘á€¬á€¸á€›á€”á€º</button></a>
        </div>
    </div>

    <div class="info-card">
        <h4>ğŸ“¢ App Policy & Guarantees</h4>
        <div class="policy-text">
            (á€™á€¼á€”á€ºá€™á€¬) á€¤ App á€á€Šá€º á€˜á€€á€ºá€œá€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸á€™á€›á€¾á€­á€á€±á€¬ Social Media á€–á€¼á€…á€ºá€•á€«á€á€Šá€ºá‹ á€”á€­á€¯á€„á€ºá€„á€¶á€¡á€á€½á€„á€ºá€¸ á€á€á€„á€ºá€¸á€™á€¾á€”á€ºá€™á€»á€¬á€¸á€›á€›á€¾á€­á€›á€±á€¸áŠ á€•á€Šá€¬á€›á€±á€¸áŠ á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸áŠ á€…á€­á€¯á€€á€ºá€•á€»á€­á€¯á€¸á€›á€±á€¸á€”á€¾á€„á€·á€º á€œá€°á€™á€¾á€¯á€›á€±á€¸á€—á€Ÿá€¯á€á€¯á€á€™á€»á€¬á€¸ á€™á€»á€¾á€á€±á€›á€”á€º á€›á€Šá€ºá€›á€½á€šá€ºá€•á€«á€á€Šá€ºá‹ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€°á€á€­á€¯á€„á€ºá€¸á Data á€€á€­á€¯ á€•á€±á€«á€€á€ºá€€á€¼á€¬á€¸á€™á€¾á€¯á€™á€›á€¾á€­á€…á€±á€›á€”á€º á€¡á€¬á€™á€á€¶á€•á€«á€á€Šá€ºá‹ 
            <br>â€¢ <b>Normal:</b> 30MB Media, 3000+ Suggestions.
            <br>â€¢ <b>Gold ($):</b> 100MB Media, 4000+ Suggestions, Livestream (No Replay), Business Posts.
            <br>â€¢ <b>Crown (ğŸ‘‘):</b> 100MB Media, 10000+ Suggestions, Lifetime Access.
            <br>âš ï¸ á€œá€°á€™á€»á€­á€¯á€¸á€›á€±á€¸áŠ á€˜á€¬á€á€¬á€›á€±á€¸ á€¡á€™á€¯á€”á€ºá€¸á€…á€€á€¬á€¸á€™á€»á€¬á€¸ á€œá€¯á€¶á€¸á€(á€œá€¯á€¶á€¸á€) á€á€½á€„á€·á€ºá€™á€•á€¼á€¯á€•á€«á‹ Likes 1000 á€™á€•á€¼á€Šá€·á€ºá€á€±á€¬ Video á€™á€»á€¬á€¸á€€á€­á€¯ á á€”á€¾á€…á€ºá€¡á€€á€¼á€¬á€á€½á€„á€º Auto á€–á€»á€€á€ºá€á€­á€™á€ºá€¸á€•á€«á€™á€Šá€ºá‹
        </div>
        <div class="policy-text en">
            (English) EmotioN is a neutral social platform for sharing authentic news, education, health, and social knowledge. We guarantee user data privacy. Hate speech regarding race or religion is strictly prohibited. Videos with less than 1000 likes will be auto-deleted after one year.
        </div>
    </div>

    <div class="feedback-container">
        <h4 style="text-align: center; width: 100%; margin-bottom: 12px;">ğŸ“ App Feedback á€•á€±á€¸á€›á€”á€º</h4>
        <textarea id="feedbackMsg" class="feedback-input" placeholder="App á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€›á€á€¬ á€¡á€†á€„á€ºá€•á€¼á€±á€›á€²á€·á€œá€¬á€¸? á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€™á€»á€¬á€¸ á€›á€±á€¸á€•á€±á€¸á€•á€«..."></textarea>
        <div class="feedback-footer" style="text-align: center;">
            <button class="feedback-btn" onclick="submitFeedback()">á€•á€­á€¯á€·á€™á€Šá€º</button>
        </div>
    </div>

    <div class="feedback-area" style="text-align: center;">
        <span class="view-feedback-btn" style="color: var(--primary-purple); font-size: 12px; cursor: pointer;" onclick="window.location.href='all_feedbacks.html'">View All App Feedbacks</span>
    </div>

    <nav class="bottom-nav">
        <a href="user.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/1946/1946488.png"><span>User</span>
        </a>
        <a href="group.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/615/615075.png"><span>Group</span>
        </a>
        <a href="chat.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/589/589708.png"><span>Chat</span>
        </a>
        <a href="live.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/4404/4404094.png"><span>Live</span>
        </a>
        <a href="profile.html" class="nav-item active">
            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077063.png"><span>Profile</span>
        </a>
    </nav>

<script>
// --- áá‹ Profile á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€€á€­á€¯ Real-time á€á€»á€­á€á€ºá€†á€€á€ºá€á€¼á€„á€ºá€¸ ---
function syncProfile() {
    auth.onAuthStateChanged((user) => {
        if (user) {
            // LocalStorage á€€á€”á€± á€¡á€›á€„á€ºá€–á€±á€¬á€ºá€™á€šá€º (á€™á€¼á€”á€ºá€¡á€±á€¬á€„á€ºá€œá€­á€¯á€·)
            if(localStorage.getItem('myAvatar')) document.getElementById('userAvatar').src = localStorage.getItem('myAvatar');
            if(localStorage.getItem('myCover')) document.getElementById('userCover').src = localStorage.getItem('myCover');

            // Database á€€á€”á€± Real-time á€•á€¼á€”á€ºá€šá€°á€™á€šá€º
            db.collection("users").doc(user.uid).onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    if (data.avatar) {
                        document.getElementById('userAvatar').src = data.avatar;
                        localStorage.setItem('myAvatar', data.avatar);
                    }
                    if (data.cover) {
                        document.getElementById('userCover').src = data.cover;
                        localStorage.setItem('myCover', data.cover);
                    }
                    document.getElementById('pName').innerText = user.displayName || "Anonymous";
                }
            });
        } else {
            document.getElementById('pName').innerText = "Guest User";
        }
    });
}

// --- á‚á‹ imgBB á€á€­á€¯á€·á€á€„á€ºá€•á€¼á€®á€¸ Firestore á€á€½á€„á€º á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€á€¼á€„á€ºá€¸ ---
async function doUpload(input, type) {
    if (!input.files?.[0]) return;
    if (!auth.currentUser) return alert("Login á€¡á€›á€„á€ºá€á€„á€ºá€•á€« Senior");

    const status = document.getElementById('status');
    status.style.display = 'block';

    const formData = new FormData();
    formData.append('image', input.files[0]);

    try {
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {
            method: 'POST',
            body: formData
        });
        const data = await res.json();

        if (data.success) {
            const url = data.data.url;
            const uid = auth.currentUser.uid;

            // Database á€™á€¾á€¬ á€á€­á€™á€ºá€¸á€™á€šá€º
            await db.collection("users").doc(uid).set({
                [type]: url,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });

            alert("á€•á€¯á€¶á€á€„á€ºá€á€¼á€„á€ºá€¸ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€º!");
        } else {
            throw new Error("Upload failed");
        }
    } catch (err) {
        alert("á€•á€¯á€¶á€á€„á€ºá€œá€­á€¯á€· á€™á€›á€•á€«á€˜á€°á€¸á€—á€»á€¬á‹ Network á€€á€­á€¯ á€•á€¼á€”á€ºá€…á€…á€ºá€•á€±á€¸á€•á€«á‹");
    } finally {
        status.style.display = 'none';
        input.value = ""; 
    }
}

// Page á€…á€–á€½á€„á€·á€ºá€á€»á€­á€”á€ºá€á€½á€„á€º á€…á€á€„á€ºá€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€…á€±á€á€¼á€„á€ºá€¸
window.onload = syncProfile;
</script>
    <script src="script.js"></script>

</body>
</html>
