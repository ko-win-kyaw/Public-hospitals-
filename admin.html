<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer Panel</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{background:#f0f2f5;font-family:sans-serif;padding:20px;}
.card{
 background:white;
 padding:15px;
 margin:15px auto;
 max-width:600px;
 border-radius:12px;
 box-shadow:0 2px 6px rgba(0,0,0,0.1)
}
.btn{
 padding:8px 12px;
 border:none;
 border-radius:6px;
 cursor:pointer;
 font-weight:bold;
 margin:5px 3px;
}
.approve{background:green;color:white}
.reject{background:red;color:white}
.ban{background:black;color:white}
</style>
</head>
<body>

<h2 style="text-align:center;color:purple;">ğŸ‘¨â€ğŸ’» Developer Approve Panel</h2>
<div id="pendingList"></div>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyD4Yiez3VXKD90za0wnt03lFPjeln4su7U",
 authDomain: "hospital-app-caf85.firebaseapp.com",
 projectId: "hospital-app-caf85",
 storageBucket: "hospital-app-caf85.firebasestorage.app",
 messagingSenderId: "736486429191",
 appId: "1:736486429191:web:25c116beb3994d213cd0a2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

/* ğŸ”’ Developer Email Lock */
const DEVELOPER_EMAIL = "uwinkyawdevelopbusinessco@gmail.com";

auth.onAuthStateChanged(user=>{
 if(!user) {
     window.location.href = "user.html";
     return;
 }

 // âœ… Email check instead of UID
 if(user.email !== DEVELOPER_EMAIL){
   alert("Access Denied âŒ Developer Only");
   window.location.href = "index.html";
   return;
 }

 loadPending();
});

function loadPending(){
 db.collection("page_info")
   .where("status", "==", "pending")
   .orderBy("createdAt", "desc")
   .onSnapshot(snap=>{
     const box = document.getElementById("pendingList");
     box.innerHTML = "";
     
     if(snap.empty){
       box.innerHTML = "<div class='card' style='text-align:center;'>âœ… No Pending Pages</div>";
       return;
     }
     
     snap.forEach(doc=>{
       const d = doc.data();
       const createdDate = d.createdAt ? d.createdAt.toDate().toLocaleString() : "Unknown";
       
       box.innerHTML += `
         <div class="card">
           <h3>ğŸ“„ ${d.pageTitle || "Untitled"}</h3>
           <p><strong>Owner UID:</strong> ${d.ownerUid || "N/A"}</p>
           <p><strong>Created:</strong> ${createdDate}</p>
           <div style="display:flex; gap:10px; margin-top:15px;">
             <button class="btn approve" onclick="approve('${doc.id}')">âœ… Approve</button>
             <button class="btn reject" onclick="reject('${doc.id}')">âŒ Reject</button>
             <button class="btn ban" onclick="ban('${doc.id}')">ğŸš« Ban</button>
           </div>
         </div>
       `;
     });
   }, error => {
     console.error("Error loading pending:", error);
     document.getElementById("pendingList").innerHTML = 
       "<div class='card' style='text-align:center;color:red;'>Error loading data</div>";
   });
}

async function approve(id){
 if(!confirm("Approve á€œá€¯á€•á€ºá€™á€œá€¬á€¸?")) return;
 try {
   await db.collection("page_info").doc(id).update({
     status: "active",
     approvedAt: firebase.firestore.FieldValue.serverTimestamp()
   });
   alert("Approved successfully!");
 } catch (error) {
   console.error("Error approving:", error);
   alert("Error approving page");
 }
}

async function reject(id){
 if(!confirm("Reject á€œá€¯á€•á€ºá€™á€œá€¬á€¸? (á€¤á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€ºá€á€Šá€º page á€€á€­á€¯ á€–á€»á€€á€ºá€•á€…á€ºá€™á€Šá€º)")) return;
 try {
   await db.collection("page_info").doc(id).delete();
   alert("Rejected and deleted!");
 } catch (error) {
   console.error("Error rejecting:", error);
   alert("Error rejecting page");
 }
}

async function ban(id){
 if(!confirm("Ban á€œá€¯á€•á€ºá€™á€œá€¬á€¸?")) return;
 try {
   await db.collection("page_info").doc(id).update({
     status: "banned",
     bannedAt: firebase.firestore.FieldValue.serverTimestamp()
   });
   alert("Banned successfully!");
 } catch (error) {
   console.error("Error banning:", error);
   alert("Error banning page");
 }
}
</script>
</body>
</html>