<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Developer Panel | EmotioN</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <style>
        :root { --purple: #800080; --bg: #f0f2f5; --card: #ffffff; --danger: #ff4757; --success: #2ed573; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .admin-container { max-width: 900px; margin: 0 auto; }
        
        /* Header Optimization */
        .header { 
            background: linear-gradient(135deg, var(--purple), #4b0082); color: white; padding: 25px; 
            border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(128, 0, 128, 0.15);
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Card System */
        .manager-card {
            background: var(--card); padding: 25px; border-radius: 18px;
            margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.03);
        }
        h4 { margin: 0 0 15px 0; font-size: 18px; display: flex; align-items: center; gap: 8px; }

        /* Input Optimization */
        .input-group { display: flex; gap: 12px; margin-top: 10px; }
        input { 
            flex: 1; padding: 14px; border: 2px solid #edf2f7; 
            border-radius: 12px; outline: none; font-size: 14px; transition: 0.3s;
        }
        input:focus { border-color: var(--purple); box-shadow: 0 0 0 4px rgba(128, 0, 128, 0.1); }

        .btn { 
            padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 700;
            border: none; transition: 0.3s; font-size: 14px; display: flex; align-items: center; gap: 5px;
        }
        .btn-vip { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* User List Style (Professional UI) */
        .user-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-radius: 12px; margin-bottom: 10px;
            background: #fff; border: 1px solid #f0f0f0; cursor: pointer; transition: 0.2s;
        }
        .user-item:hover { background: #fdfbff; border-color: var(--purple); transform: scale(1.01); }
        .user-info b { color: var(--purple); font-size: 15px; }
        .user-info small { color: #718096; display: block; margin-top: 2px; }
        .id-badge { background: #f1f5f9; padding: 4px 8px; border-radius: 6px; font-family: monospace; font-size: 11px; color: #4a5568; }

        /* Feedback Style */
        .feedback-card { 
            background: var(--card); border-radius: 16px; padding: 20px; 
            margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border-left: 5px solid var(--purple);
        }
        .msg-text { background: #f8fafc; padding: 15px; border-radius: 12px; margin: 10px 0; font-size: 14px; line-height: 1.5; }

        #userListArea { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        /* Scrollbar Style */
        #userListArea::-webkit-scrollbar { width: 6px; }
        #userListArea::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 10px; }

        .tab-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; }
        .active-tab { background: white; color: var(--purple); }
    </style>
</head>
<body>

<div class="admin-container" id="adminContent" style="display: none;">
    <div class="header">
        <div>
            <h2 style="margin:0;">Dev Panel âš™ï¸</h2>
            <small id="welcomeName">Welcome back, Senior Suresh</small>
        </div>
        <button class="tab-btn active-tab" onclick="location.reload()">ğŸ”„ Refresh Data</button>
    </div>

    <div class="manager-card">
        <h4>ğŸš€ Friends Limit Manager</h4>
        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">User á UID á€€á€­á€¯á€‘á€Šá€·á€ºá€•á€¼á€®á€¸ Friend Limit áá€á€á€á€ á€á€­á€¯á€· á€™á€¼á€¾á€„á€·á€ºá€á€„á€ºá€•á€±á€¸á€›á€”á€ºá‹</p>
        <div class="input-group">
            <input type="text" id="targetUid" placeholder="Paste User UID here...">
            <button class="btn btn-vip" onclick="makeVIP()">Upgrade to 10k</button>
        </div>
    </div>

    <div class="manager-card">
        <h4>ğŸ‘¥ Registered Users & Device IDs</h4>
        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">á€”á€¬á€™á€Šá€ºá€€á€­á€¯ á€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€›á€¯á€¶á€–á€¼á€„á€·á€º áá€„á€ºá€¸á Device ID á€€á€­á€¯ Ban á€¡á€€á€½á€€á€ºá€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</p>
        <div id="userListArea">
            <p style="text-align:center; color:#999;">Loading users...</p>
        </div>
    </div>

    <div class="manager-card" style="border-top: 5px solid var(--danger);">
        <h4 style="color: var(--danger);">ğŸš« Danger Zone: Ban System</h4>
        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">á€†á€°á€•á€°á€¡á€¯á€¶á€€á€¼á€½á€¡á€±á€¬á€„á€º á€œá€¯á€•á€ºá€á€°á UID á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Device ID á€€á€­á€¯ á€¡á€•á€¼á€®á€¸á€á€­á€¯á€„á€º Ban á€•á€«á‹</p>
        <div class="input-group">
            <input type="text" id="banTarget" placeholder="User UID á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Device ID á€€ á€’á€®á€™á€¾á€¬á€•á€±á€«á€ºá€œá€¬á€™á€šá€º">
            <button class="btn btn-danger" onclick="banUser()">Permanently Ban</button>
        </div>
    </div>

    <h3 style="margin: 30px 0 15px 10px;">ğŸ“ Recent Feedbacks</h3>
    <div id="feedbackList">
        <div class="empty">Loading feedbacks...</div>
    </div>
</div>

<div id="denied" style="display:none; text-align:center; margin-top:100px; padding: 20px;">
    <h1 style="color:var(--danger); font-size: 40px;">Access Denied! âŒ</h1>
    <p style="font-size: 18px; color: #666;">Developer Gmail á€–á€¼á€„á€·á€º á€á€„á€ºá€›á€±á€¬á€€á€ºá€™á€¾á€á€¬ á€¤ Page á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹</p>
    <button class="btn btn-vip" style="margin: 20px auto;" onclick="location.href='login.html'">Go to Login</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD4Yiez3VXKD90za0wnt03lFPjeln4su7U",
        authDomain: "hospital-app-caf85.firebaseapp.com",
        projectId: "hospital-app-caf85",
        storageBucket: "hospital-app-caf85.firebasestorage.app",
        messagingSenderId: "736486429191",
        appId: "1:736486429191:web:25c116beb3994d213cd0a2"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const seniorEmail = "uwinkyawdevelopbusinessco@gmail.com";

    // áá‹ Security Check & Initialization
    auth.onAuthStateChanged(user => {
        if (user && user.email === seniorEmail) {
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('denied').style.display = 'none';
            document.getElementById('welcomeName').innerText = `Senior: ${user.displayName || 'uwinkyaw'}`;
            
            // á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º Data á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€á€¼á€„á€ºá€¸
            loadFeedbacks();
            loadUserList(); 
        } else {
            document.getElementById('adminContent').style.display = 'none';
            document.getElementById('denied').style.display = 'block';
        }
    });

    // á‚á‹ User á€…á€¬á€›á€„á€ºá€¸á€•á€¼á€á€á€¼á€„á€ºá€¸ (Professional Interaction)
    async function loadUserList() {
        const area = document.getElementById('userListArea');
        
        // Real-time snapshot á€á€¯á€¶á€¸á€‘á€¬á€¸á€œá€­á€¯á€· User á€¡á€á€…á€ºá€á€„á€ºá€œá€¬á€›á€„á€º á€á€»á€€á€ºá€á€»á€„á€ºá€¸á€•á€±á€«á€ºá€™á€šá€º
        db.collection("users").orderBy("lastActive", "desc").limit(20).onSnapshot(snap => {
            area.innerHTML = "";
            if (snap.empty) {
                area.innerHTML = "<p style='text-align:center; color:#999;'>User á€™á€›á€¾á€­á€á€±á€¸á€•á€«</p>";
                return;
            }

            snap.forEach(doc => {
                const u = doc.data();
                const uid = doc.id;
                const deviceId = u.lastDeviceId || 'N/A';

                const div = document.createElement('div');
                div.className = "user-item";
                // á€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€á€¬á€”á€²á€· Ban á€¡á€€á€½á€€á€ºá€‘á€² ID á€›á€±á€¬á€€á€ºá€™á€šá€·á€º Interaction
                div.onclick = () => copyToBan(deviceId, u.name);

                div.innerHTML = `
                    <div class="user-info">
                        <b>ğŸ‘¤ ${u.name || 'Unknown'}</b>
                        <small>ğŸ“§ ${u.email}</small>
                        <span class="id-badge">Device: ${deviceId}</span>
                    </div>
                    <div style="text-align:right;">
                        <small style="font-size:10px; color:#aaa;">Last Active</small><br>
                        <small style="font-size:11px; font-weight:bold;">${u.lastActive ? new Date(u.lastActive.seconds*1000).toLocaleTimeString() : 'Online'}</small>
                    </div>
                `;
                area.appendChild(div);
            });
        });
    }

    // áƒá‹ Ban á€¡á€€á€½á€€á€ºá€‘á€²á€á€­á€¯á€· ID á€€á€°á€¸á€‘á€Šá€·á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸
    function copyToBan(id, name) {
        if(!id || id === 'N/A') return alert("á€¤ User á€á€½á€„á€º Device ID á€™á€á€½á€±á€·á€›á€á€±á€¸á€•á€«á‹");
        
        const banInput = document.getElementById('banTarget');
        banInput.value = id;
        
        // UI Feedback: á€á€­á€á€¬á€¡á€±á€¬á€„á€º á€á€á€¡á€›á€±á€¬á€„á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸
        banInput.style.borderColor = "var(--purple)";
        banInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        alert(`User [${name}] á Device ID á€€á€­á€¯ Ban á€…á€”á€…á€ºá€‘á€² á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹`);
    }

    // á„á‹ Ban á€¡á€€á€±á€¬á€„á€·á€º/Device á€•á€¼á€¯á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
    async function banUser() {
        const target = document.getElementById('banTarget').value.trim();
        if(!target) return alert("UID á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Device ID á€‘á€Šá€·á€ºá€•á€« Senior");

        if(confirm("á€¤ User/Device á€€á€­á€¯ á€¡á€•á€¼á€®á€¸á€á€­á€¯á€„á€º á€•á€­á€á€ºá€•á€„á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
            try {
                // Device á€€á€­á€¯ Ban á€…á€¬á€›á€„á€ºá€¸á€‘á€²á€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸
                await db.collection("banned_devices").doc(target).set({
                    deviceId: target,
                    bannedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    adminBy: seniorEmail
                });

                alert("Banned Successfully! á€¡á€†á€­á€¯á€•á€« Device á€€á€­á€¯ á€¡á€™á€¼á€²á€á€™á€ºá€¸ á€•á€­á€á€ºá€•á€„á€ºá€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹");
                document.getElementById('banTarget').value = "";
            } catch (e) {
                alert("Error: " + e.message);
            }
        }
    }

    // á…á‹ VIP Limit Upgrade
    async function makeVIP() {
        const uid = document.getElementById('targetUid').value.trim();
        if(!uid) return alert("UID á€‘á€Šá€·á€ºá€•á€±á€¸á€•á€« Senior");

        try {
            await db.collection("users").doc(uid).update({
                friendLimit: 10000,
                isVIP: true
            });
            alert("Upgrade Success! Friend Limit 10,000 á€›á€›á€¾á€­á€á€½á€¬á€¸á€•á€«á€•á€¼á€®á‹");
            document.getElementById('targetUid').value = "";
        } catch (e) {
            alert("Error: " + e.message);
        }
    }

    // á†á‹ Feedbacks á€†á€½á€²á€šá€°á€á€¼á€„á€ºá€¸
    function loadFeedbacks() {
        db.collection("feedbacks").orderBy("createdAt", "desc").onSnapshot(snap => {
            const listDiv = document.getElementById('feedbackList');
            listDiv.innerHTML = "";
            
            snap.forEach(doc => {
                const d = doc.data();
                const time = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleString() : "Just now";
                
                const card = document.createElement('div');
                card.className = "feedback-card";
                card.innerHTML = `
                    <div class="user-meta">
                        <span class="user-name">ğŸ‘¤ ${d.userName || 'Anonymous User'}</span>
                        <span class="time">ğŸ•’ ${time}</span>
                    </div>
                    <div class="msg-text">${d.feedbackMsg || d.text || 'á€…á€¬á€á€¬á€¸á€™á€›á€¾á€­á€•á€«'}</div>
                    <div class="device-info">
                        <span>ğŸ“± ${d.device || 'Mobile'}</span>
                        <span>ğŸ“¦ v${d.version || '1.0.0'}</span>
                        <span class="id-badge">ID: ${d.uid ? d.uid.substring(0,10) : 'N/A'}</span>
                    </div>
                `;
                listDiv.appendChild(card);
            });
        });
    }
</script>
</body>
</html>
